# QUANTA II ç³»çµ±é–‹ç™¼èªªæ˜æ–‡ä»¶ï¼šv2.0 In-Sample / Out-of-Sample æ¶æ§‹

## é–‹ç™¼ç›®æ¨™

å»ºç«‹ä¸€å¥—æ¨¡çµ„åŒ–ã€å¯æ“´å±•ã€ä¸”åŒ…å«**æ¨£æœ¬å…§ (In-Sample) è¨“ç·´**èˆ‡**æ¨£æœ¬å¤– (Out-of-Sample) é©—è­‰**æµç¨‹çš„é‡åŒ–äº¤æ˜“å›æ¸¬ç³»çµ±ã€‚ç³»çµ±æ ¸å¿ƒæµç¨‹åˆ†ç‚ºä»¥ä¸‹æ¨¡çµ„ï¼š

*   **M0ï¼šæ­·å²è³‡æ–™è¼‰å…¥æ¨¡çµ„ (`m0_data_loader.py`)**
*   **M1ï¼šç­–ç•¥åƒæ•¸ç”¢ç”Ÿæ¨¡çµ„ (`m1_param_generator.py`)**
*   **M2ï¼šæ¨£æœ¬å…§ (In-Sample) å›æ¸¬æ¨¡çµ„ (`m2_signal_generator_batch.py`, `m2_performance_from_signals_batch.py`)**
*   **M3ï¼šæœ€ä½³ç­–ç•¥ç¯©é¸æ¨¡çµ„ (`m3_strategy_selector.py`)**
*   **M4ï¼šæ¨£æœ¬å¤– (Out-of-Sample) é©—è­‰æ¨¡çµ„ (`m4_1_validation_signal_generator.py`, `m4_2_validation_performance.py`)**

---

## ğŸš€ ç³»çµ±åŸ·è¡Œæµç¨‹

æ–°çš„æ¶æ§‹æ ¸å¿ƒåœ¨æ–¼å°‡ç­–ç•¥çš„ã€Œæ¢ç´¢ã€èˆ‡ã€Œé©—è­‰ã€åˆ†é›¢ï¼Œé¿å…éæ“¬åˆ (Overfitting)ã€‚

```mermaid
graph TD
    subgraph "æº–å‚™éšæ®µ"
        A[M0: æ­·å²è³‡æ–™è¼‰å…¥] --> B[M1: ç”¢ç”Ÿå¤§é‡ç­–ç•¥åƒæ•¸];
    end
    subgraph "æ¨£æœ¬å…§ (In-Sample) è¨“ç·´"
        B --> C[M2.1: ä½¿ç”¨ In-Sample è³‡æ–™<br>ç”¢ç”Ÿæ‰€æœ‰åƒæ•¸çš„è¨Šè™Ÿ];
        C --> D[M2.2: è¨ˆç®—æ‰€æœ‰è¨Šè™Ÿçš„ç¸¾æ•ˆ];
    end
    subgraph "ç­–ç•¥ç¯©é¸"
        D --> E[M3: ä¾æ“š In-Sample ç¸¾æ•ˆ<br>ç¯©é¸å‡º Top N æœ€ä½³ç­–ç•¥];
    end
    subgraph "æ¨£æœ¬å¤– (Out-of-Sample) é©—è­‰"
        E --> F[M4.1: ä½¿ç”¨ Out-of-Sample è³‡æ–™<br>ç‚ºæœ€ä½³ç­–ç•¥ç”¢ç”Ÿé©—è­‰è¨Šè™Ÿ];
        F --> G[M4.2: è¨ˆç®—é©—è­‰è¨Šè™Ÿçš„æœ€çµ‚ç¸¾æ•ˆ];
    end
    G --> H[ç”¢å‡ºæœ€çµ‚é©—è­‰å ±å‘Š];
```

---

## ğŸ“‚ è³‡æ–™å¤¾èˆ‡æª”æ¡ˆç¸½è¦½

æ–°çš„æª”æ¡ˆçµæ§‹åœç¹ `in_sample` å’Œ `out_sample` çµ„ç¹”ï¼Œä»¥ç¢ºä¿æ•¸æ“šå’Œçµæœçš„æ¸…æ™°éš”é›¢ã€‚

```
QuantaIII/
â”œâ”€â”€ data_csv/                       # M0 è¼¸å‡ºï¼šæ­·å²åƒ¹æ ¼ (CSV)
â”œâ”€â”€ strategies/
â”‚   â”œâ”€â”€ in_sample/
â”‚   â”‚   â”œâ”€â”€ all_params/             # M1 è¼¸å‡ºï¼šæ‰€æœ‰ç­–ç•¥çš„åƒæ•¸çµ„åˆ (JSON)
â”‚   â”‚   â””â”€â”€ best/                   # M3 è¼¸å‡ºï¼šæ¨£æœ¬å…§æœ€ä½³ç­–ç•¥ (CSV)
â”‚   â””â”€â”€ out_sample/
â”‚       â”œâ”€â”€ param_logs/             # M3 è¼¸å‡ºï¼šæœ€ä½³ç­–ç•¥çš„è©³ç´°åƒæ•¸ (JSON)
â”‚       â””â”€â”€ best/                   # M5 è¼¸å‡ºï¼šæœ€çµ‚é©—è­‰å¾Œçš„æœ€ä½³ç­–ç•¥ (CSV)
â”œâ”€â”€ signals/
â”‚   â”œâ”€â”€ in_sample/                  # M2.1 è¼¸å‡ºï¼šæ¨£æœ¬å…§æ‰€æœ‰ç­–ç•¥çš„è¨Šè™Ÿ (CSV)
â”‚   â””â”€â”€ out_sample/                 # M4.1 è¼¸å‡ºï¼šæ¨£æœ¬å¤–æœ€ä½³ç­–ç•¥çš„è¨Šè™Ÿ (CSV)
â”œâ”€â”€ performance/
â”‚   â”œâ”€â”€ in_sample/                  # M2.2 è¼¸å‡ºï¼šæ¨£æœ¬å…§æ‰€æœ‰ç­–ç•¥çš„ç¸¾æ•ˆ (CSV)
â”‚   â””â”€â”€ out_sample/                 # M4.2 è¼¸å‡ºï¼šæ¨£æœ¬å¤–æœ€ä½³ç­–ç•¥çš„ç¸¾æ•ˆ (CSV)
â”œâ”€â”€ modules/                        # æ‰€æœ‰æ¨¡çµ„å¯¦ä½œ
â”‚   â”œâ”€â”€ m0_data_loader.py
â”‚   â”œâ”€â”€ m1_param_generator.py
â”‚   â”œâ”€â”€ m2_signal_generator_batch.py
â”‚   â”œâ”€â”€ m2_performance_from_signals_batch.py
â”‚   â”œâ”€â”€ m3_strategy_selector.py
â”‚   â”œâ”€â”€ m4_1_validation_signal_generator.py
â”‚   â”œâ”€â”€ m4_2_validation_performance.py
â”‚   â””â”€â”€ m5_validation_strategy_selector.py
â””â”€â”€ utils/                          # å…±ç”¨å·¥å…·å‡½æ•¸
```

---

## ğŸ§© å„æ¨¡çµ„åŠŸèƒ½èˆ‡è¼¸å‡ºèªªæ˜

#### ğŸ”¹ M0: è³‡æ–™è¼‰å…¥ (`m0_data_loader.py`)
*   **åŠŸèƒ½**: å¾ CSV æª”æ¡ˆè®€å–æ­·å²è‚¡åƒ¹è³‡æ–™ï¼Œä¸¦å¯å­˜å…¥ SQLite è³‡æ–™åº«ã€‚
*   **è¼¸å‡º**: `database/stock_price.db`

#### ğŸ”¹ M1: åƒæ•¸ç”¢ç”Ÿ (`m1_param_generator.py`)
*   **åŠŸèƒ½**: ç‚ºæŒ‡å®šçš„ç­–ç•¥ï¼ˆå¦‚ RSI, CROSSï¼‰è‡ªå‹•ç”¢ç”Ÿå¤§é‡çš„åƒæ•¸çµ„åˆã€‚
*   **è¼¸å‡º**: `strategies/in_sample/all_params/param_log_*.json`

#### ğŸ”¹ M2: In-Sample å›æ¸¬ (`m2_*_batch.py`)
*   **åŠŸèƒ½**: æ ¹æ“š M1 ç”¢ç”Ÿçš„æ‰€æœ‰åƒæ•¸ï¼Œåœ¨**æ¨£æœ¬å…§**è³‡æ–™ä¸ŠåŸ·è¡Œå¤§è¦æ¨¡ã€ä¸¦è¡ŒåŒ–çš„è¨Šè™Ÿç”Ÿæˆèˆ‡å›æ¸¬ã€‚
*   **æ ¸å¿ƒ**:
    *   `m2_signal_generator_batch.py`: ç”¢ç”ŸåŒ…å«æ‰€æœ‰ç­–ç•¥è¨Šè™Ÿçš„å–®ä¸€å¤§å‹ CSV æª”ã€‚
    *   `m2_performance_from_signals_batch.py`: è®€å–ä¸Šè¿°è¨Šè™Ÿæª”ï¼Œè¨ˆç®—æ¯å€‹ç­–ç•¥çš„ç¸¾æ•ˆã€‚
*   **è¼¸å‡º**:
    *   `signals/in_sample/SIGNALS_*.csv`
    *   `performance/in_sample/PERFORMANCE_*.csv`

#### ğŸ”¹ M3: æœ€ä½³ç­–ç•¥ç¯©é¸ (`m3_strategy_selector.py`)
*   **åŠŸèƒ½**: è®€å– M2 çš„æ¨£æœ¬å…§ç¸¾æ•ˆå ±å‘Šï¼Œæ ¹æ“šæŒ‡å®šæŒ‡æ¨™ï¼ˆé è¨­ç‚º `sharpe`ï¼‰ç¯©é¸å‡ºè¡¨ç¾æœ€ä½³çš„ç­–ç•¥ã€‚
*   **æ ¸å¿ƒ**:
    1.  æ‰¾åˆ°ç¸¾æ•ˆæœ€å¥½çš„ Top N å€‹ `param_id`ã€‚
    2.  å°‡é€™äº› `param_id` çš„ç¸¾æ•ˆæ‘˜è¦å„²å­˜èµ·ä¾†ã€‚
    3.  å¾ M1 çš„ `param_log` ä¸­ï¼Œæ‰¾åˆ°é€™äº› `param_id` å°æ‡‰çš„å®Œæ•´åƒæ•¸ï¼Œä¸¦è¤‡è£½åˆ° `out_sample` ç›®éŒ„ä»¥ä¾› M4 ä½¿ç”¨ã€‚
*   **è¼¸å‡º**:
    *   `strategies/in_sample/best/best_strategies_*.csv`
    *   `strategies/out_sample/param_logs/param_log_*.json` (åªåŒ…å«æœ€ä½³ç­–ç•¥çš„åƒæ•¸)

#### ğŸ”¹ M4: Out-of-Sample é©—è­‰ (`m4_*.py`)
*   **åŠŸèƒ½**: ä½¿ç”¨ M3 æŒ‘é¸å‡ºçš„æœ€ä½³ç­–ç•¥ï¼Œåœ¨**æ¨£æœ¬å¤–**çš„æ­·å²è³‡æ–™ä¸Šé€²è¡Œå›æ¸¬ï¼Œä»¥é©—è­‰ç­–ç•¥çš„çœŸå¯¦è¡¨ç¾ã€‚
*   **æ ¸å¿ƒ**:
    *   `m4_1_validation_signal_generator.py`: è‡ªå‹•è®€å– M3 ç¯©é¸å‡ºçš„æœ€ä½³ç­–ç•¥åƒæ•¸ï¼Œåœ¨ Out-of-Sample è³‡æ–™ä¸Šç”¢ç”Ÿè¨Šè™Ÿã€‚
    *   `m4_2_validation_performance.py`: è‡ªå‹•è®€å– M4.1 ç”¢ç”Ÿçš„è¨Šè™Ÿæª”ï¼Œè¨ˆç®—æœ€çµ‚çš„æ¨£æœ¬å¤–ç¸¾æ•ˆã€‚
*   **è¼¸å‡º**:
    *   `signals/out_sample/SIGNALS_*_validation.csv`
    *   `performance/out_sample/PERFORMANCE_*_validation.csv`

---

## ğŸ§  ç³»çµ±è¨­è¨ˆåŸå‰‡èˆ‡è®Šæ›´
*   **In-Sample / Out-of-Sample åˆ†é›¢**: é€™æ˜¯æœ€é‡è¦çš„è®Šæ›´ï¼Œæ—¨åœ¨é€éç¨ç«‹çš„é©—è­‰é›†ä¾†æ¸¬è©¦ç­–ç•¥çš„ç©©å¥æ€§ï¼Œæœ‰æ•ˆé™ä½éæ“¬åˆé¢¨éšªã€‚
*   **è‡ªå‹•åŒ–æµç¨‹**: M3 å’Œ M4 ä¹‹é–“çš„æµç¨‹æ˜¯è‡ªå‹•åŒ–çš„ã€‚M4 æœƒè‡ªå‹•å°‹æ‰¾ M3 ç”¢ç”Ÿçš„æœ€æ–°æœ€ä½³ç­–ç•¥æª”æ¡ˆé€²è¡Œé©—è­‰ï¼Œç„¡éœ€æ‰‹å‹•æŒ‡å®šã€‚
*   **æ‰¹æ¬¡è™•ç†**: M2 æ¨¡çµ„æ¡ç”¨æ‰¹æ¬¡ (batch) è™•ç†ï¼Œèƒ½å¤ é«˜æ•ˆåœ°å°æ•¸åƒå€‹åƒæ•¸çµ„åˆé€²è¡Œå›æ¸¬ã€‚
*   **æª”æ¡ˆå‘½å**: æª”æ¡ˆå‘½åè¦å‰‡æ¸…æ™°ï¼ŒåŒ…å«æ¨¡çµ„ã€æ—¥æœŸã€`in_sample`/`out_sample` ç­‰é—œéµè³‡è¨Šï¼Œæ˜“æ–¼è¿½è¹¤å’Œç®¡ç†ã€‚
*   **ä½è€¦åˆ**: æ¨¡çµ„ä¹‹é–“ä¾ç„¶é€éæª”æ¡ˆç³»çµ±é€²è¡Œæ•¸æ“šäº¤æ›ï¼Œä¿æŒäº†ç³»çµ±çš„éˆæ´»æ€§å’Œå¯ç¶­è­·æ€§ã€‚
